---
import type { GetStaticPaths, Page } from 'astro'
import BaseLayout from '../../layouts/BaseLayout.astro'
import BlogIndex from '../../components/blog/BlogIndex.astro'
import { getCollection } from 'astro:content'

type Props = {
  page: Page
  allTags: string[]
}

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const blogEntries = (await getCollection('blog')).sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime()
  )

  // Collect all unique tags
  const allTags = [
    ...new Set(blogEntries.flatMap((entry) => entry.data.tags))
  ].sort()

  return paginate(blogEntries, {
    pageSize: 10,
    props: { allTags }
  })
}

const { page, allTags } = Astro.props
---

<BaseLayout
  title="Engineering Blog"
  description="Hear stories and experiences from the team who is working on making Interledger, the interoperable global payments network, a reality."
  ogImageUrl={new URL('/developers/img/blog/og-image.png', Astro.site).href}
>
  <BlogIndex
    title="Engineering Blog"
    posts={page.data || []}
    breadcrumbs={[
      {
        name: 'Developers Portal',
        href: '/developers',
        umamiEvent: 'Devs breadcrumb - Home'
      }
    ]}
    allTags={allTags}
    showTagFilter={true}
    showPagination={true}
    paginationProps={{
      length: page.lastPage,
      currentPage: page.currentPage,
      firstUrl: page.url.first,
      prevUrl: page.url.prev,
      nextUrl: page.url.next,
      lastUrl: page.url.last
    }}
  />
</BaseLayout>
