---
import { getCollection, render } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'

const events = await getCollection('events')
const sortedEvents = events.sort(
  (a, b) => (a.data.order || 0) - (b.data.order || 0)
)

// Render all events to get their Content components
const renderedEvents = await Promise.all(
  sortedEvents.map(async (event) => ({
    ...event,
    Content: (await render(event)).Content
  }))
)
---

<BaseLayout
  title="Events - Interledger Foundation"
  description="Create space to be inspired"
>
  <main>
    <section class="hero">
      <div class="content-wrapper">
        <h1 class="hero__title">Events</h1>
        <p class="hero__subtitle">Create space to be inspired</p>
      </div>
    </section>

    <section class="events-section">
      <div class="content-wrapper">
        <div class="events-grid">
          {
            renderedEvents.map((event, index) => {
              const hasImage = Boolean(event.data.featuredImage)
              return (
                <article
                  class={`event-card ${index % 2 === 1 ? 'event-card--reverse' : ''} ${!hasImage ? 'event-card--no-image' : ''}`}
                >
                  <div class="event-copy">
                    <h2 class="event-title">{event.data.title}</h2>
                    <div class="event-body">
                      <event.Content />
                    </div>
                  </div>
                  {hasImage && (
                    <div class="event-image">
                      <img
                        src={event.data.featuredImage}
                        alt={event.data.title}
                        loading="lazy"
                      />
                    </div>
                  )}
                </article>
              )
            })
          }
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  main {
    padding-block-end: var(--space-xl);
  }

  .hero {
    background: linear-gradient(
      135deg,
      oklch(35% 0.12 200) 0%,
      oklch(45% 0.1 190) 30%,
      oklch(50% 0.08 180) 60%,
      oklch(55% 0.06 170) 100%
    );
    padding: var(--space-xl) 0;
    color: var(--color-white);
    text-align: center;
  }

  .hero__title {
    font-size: var(--step-6);
    font-weight: 700;
    margin-block-end: var(--space-xs);
    text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
  }

  .hero__subtitle {
    font-size: var(--step-2);
    font-weight: 300;
    font-style: italic;
    opacity: 0.95;
  }

  .events-section {
    background:
      radial-gradient(
        circle at 30% 20%,
        rgba(255, 148, 128, 0.25),
        transparent 45%
      ),
      radial-gradient(
        circle at 80% 10%,
        rgba(111, 181, 255, 0.3),
        transparent 40%
      ),
      linear-gradient(180deg, #f7f8fb 0%, #f1f7f8 50%, #f7f8fb 100%);
    padding-block: var(--space-xl);
  }

  .events-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-l);
  }

  .event-card {
    display: grid;
    grid-template-columns: 1.05fr 0.95fr;
    gap: var(--space-l);
    align-items: center;
    padding: var(--space-l);
    background: rgba(255, 255, 255, 0.9);
    border-radius: 18px;
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
  }

  .event-card--reverse .event-copy {
    order: 2;
  }

  .event-card--reverse .event-image {
    order: 1;
  }

  .event-card--no-image {
    grid-template-columns: 1fr;
  }

  .event-title {
    font-size: var(--step-4);
    margin-block-end: var(--space-s);
  }

  .event-body {
    font-size: var(--step-0);
    line-height: 1.8;
    color: var(--color-black);
  }

  .event-body :global(p) {
    margin-block-end: var(--space-s);
  }

  .event-body :global(h3) {
    font-size: var(--step-1);
    font-weight: 600;
    margin-block: var(--space-m) var(--space-2xs);
  }

  .event-body :global(ul),
  .event-body :global(ol) {
    margin-block: var(--space-s);
    padding-inline-start: var(--space-m);
  }

  .event-body :global(li) {
    margin-block-end: var(--space-2xs);
  }

  .event-body :global(a) {
    color: var(--color-primary);
    font-weight: 600;
  }

  .event-body :global(strong) {
    color: inherit;
    font-weight: 700;
  }

  .event-body :global(em) {
    color: inherit;
  }

  .event-image {
    position: relative;
    overflow: hidden;
    border-radius: 14px;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
  }

  .event-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  @media screen and (max-width: 799px) {
    .hero {
      padding: var(--space-l) 0;
    }

    .hero__title {
      font-size: var(--step-4);
    }

    .hero__subtitle {
      font-size: var(--step-0);
    }

    .events-section {
      padding-block: var(--space-l);
    }

    .event-card {
      grid-template-columns: 1fr;
      gap: var(--space-m);
      padding: var(--space-m);
    }

    .event-card--reverse .event-copy,
    .event-card--reverse .event-image {
      order: unset;
    }

    .event-image {
      max-height: 280px;
    }

    .event-title {
      font-size: var(--step-3);
    }
  }
</style>
